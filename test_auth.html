<!DOCTYPE html>
<html>
<head>
    <title>Test Auth Logic</title>
</head>
<body>
    <h1>Test Authentication Logic</h1>
    <div id="result"></div>
    
    <script>
        // Симулируем различные сценарии
        const scenarios = [
            {
                name: "No Telegram WebApp",
                setup: () => {
                    delete window.Telegram;
                }
            },
            {
                name: "Telegram WebApp with empty initData",
                setup: () => {
                    window.Telegram = {
                        WebApp: {
                            initData: ""
                        }
                    };
                }
            },
            {
                name: "Telegram WebApp with real initData",
                setup: () => {
                    window.Telegram = {
                        WebApp: {
                            initData: "user=%7B%22id%22%3A123456789%2C%22first_name%22%3A%22John%22%2C%22last_name%22%3A%22Doe%22%2C%22username%22%3A%22johndoe%22%7D&auth_date=1234567890&hash=abcdef123456"
                        }
                    };
                }
            }
        ];
        
        // Функция проверки доступности Telegram WebApp API
        const isTelegramWebAppAvailable = () => {
            try {
                return typeof window !== 'undefined' && 
                       typeof window.Telegram !== 'undefined' && 
                       typeof window.Telegram.WebApp !== 'undefined';
            } catch (e) {
                return false;
            }
        };
        
        // Тестируем каждый сценарий
        let results = [];
        
        scenarios.forEach(scenario => {
            scenario.setup();
            
            const isAvailable = isTelegramWebAppAvailable();
            let initData = '';
            
            try {
                if (isAvailable) {
                    initData = window.Telegram?.WebApp?.initData || '';
                }
            } catch (e) {
                console.warn('Error accessing Telegram WebApp:', e);
            }
            
            const shouldUseMock = !initData || initData === '';
            
            results.push({
                scenario: scenario.name,
                telegramAvailable: isAvailable,
                initData: initData,
                shouldUseMock: shouldUseMock,
                decision: shouldUseMock ? "Use Mock User" : "Use Real Auth"
            });
        });
        
        // Отображаем результаты
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '<h2>Test Results:</h2>' + 
            results.map(r => `
                <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                    <h3>${r.scenario}</h3>
                    <p><strong>Telegram Available:</strong> ${r.telegramAvailable}</p>
                    <p><strong>InitData:</strong> ${r.initData || 'empty'}</p>
                    <p><strong>Should Use Mock:</strong> ${r.shouldUseMock}</p>
                    <p><strong>Decision:</strong> ${r.decision}</p>
                </div>
            `).join('');
    </script>
</body>
</html> 